<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
  <title>–ú—É–∑—ã–∫–∞ –≤ Telegram</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg: #0e0e0e;
      --card: #1a1a1a;
      --text: #ffffff;
      --text-secondary: #b3b3b3;
      --accent: #ff0000; /* YouTube red */
      --green: #1DB954;
    }
    body { 
      margin:0; padding:0; background:var(--bg); color:var(--text); 
      font-family:'Inter',sans-serif; min-height:100vh;
    }
    .container { padding:20px; max-width:500px; margin:0 auto; }
    h1 { text-align:center; margin:0 0 30px; font-size:24px; }
    .search-box {
      position:relative; margin-bottom:25px;
    }
    .search-box input {
      width:100%; padding:16px 50px 16px 20px; border-radius:50px;
      border:none; background:#2a2a2a; color:white; font-size:17px;
      outline:none;
    }
    .search-box button {
      position:absolute; right:6px; top:6px; width:48px; height:48px;
      background:var(--accent); border:none; border-radius:50%; 
      color:white; font-size:22px; cursor:pointer;
    }
    .results { margin-top:10px; }
    .track {
      display:flex; align-items:center; background:var(--card); 
      border-radius:16px; padding:12px; margin-bottom:12px; cursor:pointer;
      transition:0.2s; gap:14px;
    }
    .track:hover { background:#2a2a2a; transform:translateY(-2px); }
    .track img { width:64px; height:64px; border-radius:12px; object-fit:cover; }
    .track-info h3 { margin:0; font-size:16px; }
    .track-info p { margin:4px 0 0; font-size:13px; color:var(--text-secondary); }
    .service { background:var(--accent); padding:2px 8px; border-radius:6px; font-size:11px; margin-left:8px; }
    .player {
      position:fixed; bottom:0; left:0; right:0; background:var(--card);
      padding:16px; border-top:1px solid #333; backdrop-filter:blur(10px);
      display:none; z-index:1000;
    }
    .now-playing { display:flex; align-items:center; gap:14px; }
    .now-playing img { width:56px; height:56px; border-radius:10px; }
    .no-results { text-align:center; padding:40px; color:var(--text-secondary); }
    .loading { text-align:center; padding:30px; }
    .spinner { border:4px solid #333; border-top:4px solid var(--accent); border-radius:50%; width:40px; height:40px; animation:spin 1s linear infinite; margin:0 auto; }
    @keyframes spin { to { transform:rotate(360deg); } }
    .video-player { width:100%; height:200px; border-radius:12px; margin-top:10px; }
  </style>
</head>
<body>

<div class="container">
  <h1>üéµ YouTube Music Search</h1>
  
  <div class="search-box">
    <input type="text" id="query" placeholder="–í–≤–µ–¥–∏ –Ω–∞–∑–≤–∞–Ω–∏–µ —Ç—Ä–µ–∫–∞ –∏–ª–∏ –∞—Ä—Ç–∏—Å—Ç–∞..." autocomplete="off" />
    <button onclick="search()">üîç</button>
  </div>

  <div id="content">
    <p class="no-results">–ù–∞—á–Ω–∏ –ø–æ–∏—Å–∫ ‚Äî –Ω–∞–π–¥—É –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—É—é –º—É–∑—ã–∫—É –Ω–∞ YouTube</p>
  </div>
</div>

<div class="player" id="player">
  <div class="now-playing">
    <img id="cover" src="" alt="">
    <div>
      <h3 id="title">‚Äî</h3>
      <p id="artist">‚Äî</p>
    </div>
  </div>
  <div id="video-container" class="video-player"></div>
</div>

<script>
// === YouTube Music Search (—Ä–∞–±–æ—Ç–∞–µ—Ç –±–µ–∑ API-–∫–ª—é—á–∞, —á–µ—Ä–µ–∑ CORS-–ø—Ä–æ–∫—Å–∏ + –ø–∞—Ä—Å–∏–Ω–≥) ===
let tracks = [];

async function search() {
  const query = document.getElementById('query').value.trim();
  if (!query) return;

  document.getElementById('content').innerHTML = '<div class="loading"><div class="spinner"></div><p>–ò—â–µ–º –Ω–∞ YouTube Music...</p></div>';

  try {
    // CORS-–ø—Ä–æ–∫—Å–∏ + YouTube search (—Ñ–∏–ª—å—Ç—Ä –Ω–∞ –º—É–∑—ã–∫—É)
    const searchUrl = `https://www.youtube.com/results?search_query=${encodeURIComponent(query + ' official audio')}`;
    const res = await fetch(`https://api.allorigins.win/raw?url=${encodeURIComponent(searchUrl)}`);
    const html = await res.text();

    // –ü–∞—Ä—Å–∏–º videoId –∏–∑ HTML (–Ω–∞–¥—ë–∂–Ω—ã–π regex –¥–ª—è 2025)
    const videoIds = [];
    const regex = /"videoId":"([a-zA-Z0-9_-]{11})"/g;
    let match;
    while ((match = regex.exec(html)) !== null) {
      if (!videoIds.includes(match[1])) {
        videoIds.push(match[1]);
      }
    }

    if (videoIds.length > 0) {
      tracks = videoIds.slice(0, 10).map(id => ({
        id: id,
        title: `${query} (Official Audio)`, // –ó–∞–≥–æ–ª–æ–≤–æ–∫ –∏–∑ –ø–æ–∏—Å–∫–∞
        artist: 'YouTube Music',
        cover: `https://i.ytimg.com/vi/${id}/hqdefault.jpg`,
        videoUrl: `https://www.youtube.com/watch?v=${id}`
      }));
      displayTracks(tracks);
    } else {
      document.getElementById('content').innerHTML = '<p class="no-results">–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ –ø–æ –∑–∞–ø—Ä–æ—Å—É. –ü–æ–ø—Ä–æ–±—É–π —Ç–æ—á–Ω–µ–µ!</p>';
    }
  } catch(e) {
    document.getElementById('content').innerHTML = '<p class="no-results">–û—à–∏–±–∫–∞ —Å–µ—Ç–∏, –ø–æ–ø—Ä–æ–±—É–π –ø–æ–∑–∂–µ</p>';
    console.error(e);
  }
}

function displayTracks(tracks) {
  document.getElementById('content').innerHTML = '<div class="results">' + tracks.map((t,i) => `
    <div class="track" onclick="playTrack(${i})">
      <img src="${t.cover}" onerror="this.src='https://i.imgur.com/3dRxX4V.jpg'">
      <div class="track-info">
        <h3>${t.title}</h3>
        <p>${t.artist} <span class="service">YouTube</span></p>
      </div>
    </div>
  `).join('') + '</div>';
}

function playTrack(i) {
  const t = tracks[i];
  document.getElementById('title').textContent = t.title;
  document.getElementById('artist').textContent = t.artist;
  document.getElementById('cover').src = t.cover;

  // Embed YouTube –≤–∏–¥–µ–æ —Å –∞–≤—Ç–æ–ø–ª–µ–µ–º
  const videoId = t.id;
  document.getElementById('video-container').innerHTML = `
    <iframe 
      src="https://www.youtube.com/embed/${videoId}?autoplay=1&rel=0&modestbranding=1&playsinline=1" 
      frameborder="0" 
      allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
      allowfullscreen 
      class="video-player"
    ></iframe>
  `;
  
  document.getElementById('player').style.display = 'block';
  Telegram.WebApp.HapticFeedback.selectionChanged();
}

// Enter ‚Üí –ø–æ–∏—Å–∫
document.getElementById('query').addEventListener('keypress', e => { if(e.key==='Enter') search(); });

// Telegram –≥–æ—Ç–æ–≤
Telegram.WebApp.ready();
Telegram.WebApp.expand();
document.body.style.marginBottom = '240px'; // –æ—Ç—Å—Ç—É–ø –ø–æ–¥ –ø–ª–µ–µ—Ä
</script>

</body>
</html>
