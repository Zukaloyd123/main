<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
  <title>üéµ YouTube Music –≤ Telegram</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg: linear-gradient(135deg, #0f0f0f 0%, #1a1a1a 100%);
      --card: rgba(255,255,255,0.05);
      --text: #ffffff;
      --text-secondary: #b3b3b3;
      --accent: #ff0000;
      --border: rgba(255,255,255,0.1);
      --shadow: 0 8px 32px rgba(0,0,0,0.3);
    }
    * { box-sizing: border-box; }
    body { 
      margin:0; padding:0; background:var(--bg); color:var(--text); 
      font-family:'Inter',sans-serif; min-height:100vh; overflow-x:hidden;
    }
    .container { padding:20px; max-width:500px; margin:0 auto; }
    h1 { 
      text-align:center; margin:0 0 30px; font-size:28px; font-weight:700; 
      background:linear-gradient(45deg, var(--accent), #ff6b6b); -webkit-background-clip:text; -webkit-text-fill-color:transparent;
    }
    .search-box {
      position:relative; margin-bottom:25px; display:flex;
    }
    .search-box input {
      flex:1; padding:18px 20px; border-radius:25px 0 0 25px;
      border:none; background:rgba(42,42,42,0.8); color:white; font-size:17px;
      outline:none; backdrop-filter:blur(10px);
    }
    .search-box button {
      padding:18px 24px; background:var(--accent); border:none; border-radius:0 25px 25px 0; 
      color:white; font-size:18px; font-weight:500; cursor:pointer; transition:0.2s;
    }
    .search-box button:hover { background:#cc0000; transform:scale(1.05); }
    .results { display:grid; gap:15px; }
    .track {
      display:flex; align-items:center; background:var(--card); 
      border-radius:20px; padding:16px; cursor:pointer; transition:0.3s;
      border:1px solid var(--border); backdrop-filter:blur(10px);
    }
    .track:hover { transform:translateY(-4px); box-shadow:var(--shadow); border-color:var(--accent); }
    .track img { width:70px; height:70px; border-radius:15px; object-fit:cover; margin-right:16px; }
    .track-info { flex:1; }
    .track-info h3 { margin:0 0 4px; font-size:16px; font-weight:600; }
    .track-info p { margin:0; font-size:14px; color:var(--text-secondary); }
    .service { background:var(--accent); color:white; padding:4px 10px; border-radius:12px; font-size:12px; font-weight:500; }
    .duration { font-size:12px; color:var(--text-secondary); margin-left:auto; }
    .views { font-size:12px; color:var(--text-secondary); margin-top:4px; }
    .player {
      position:fixed; bottom:0; left:0; right:0; background:linear-gradient(180deg, rgba(0,0,0,0.8), rgba(0,0,0,0.95)); 
      padding:20px; border-top:1px solid var(--border); backdrop-filter:blur(20px); display:none; z-index:1000;
    }
    .now-playing { display:flex; align-items:center; gap:16px; margin-bottom:12px; }
    .now-playing img { width:60px; height:60px; border-radius:12px; }
    .controls { display:flex; justify-content:space-between; align-items:center; margin:12px 0; }
    .controls button { background:none; border:none; color:var(--text); font-size:24px; cursor:pointer; padding:8px; border-radius:50%; transition:0.2s; }
    .controls button:hover { background:var(--card); }
    .progress { height:4px; background:var(--border); border-radius:2px; overflow:hidden; margin:8px 0; }
    .progress-bar { height:100%; background:linear-gradient(90deg, var(--accent), #ff6b6b); width:0%; transition:width 0.1s; }
    .no-results, .loading { text-align:center; padding:60px 20px; color:var(--text-secondary); }
    .spinner { border:3px solid var(--border); border-top:3px solid var(--accent); border-radius:50%; width:40px; height:40px; animation:spin 1s linear infinite; margin:0 auto 20px; }
    @keyframes spin { to { transform:rotate(360deg); } }
    .video-player { width:100%; height:220px; border-radius:16px; margin-top:12px; }
    .playlist-btn { position:fixed; top:20px; right:20px; background:var(--accent); color:white; border:none; border-radius:50%; width:50px; height:50px; font-size:20px; cursor:pointer; z-index:1001; }
    .track { animation: fadeInUp 0.3s ease-out; }
    @keyframes fadeInUp { from { opacity:0; transform:translateY(20px); } to { opacity:1; transform:translateY(0); } }
  </style>
</head>
<body>

<div class="container">
  <h1>üéµ YouTube Music</h1>
  
  <div class="search-box">
    <input type="text" id="query" placeholder="–ò—â–∏ —Ç—Ä–µ–∫–∏, –∞—Ä—Ç–∏—Å—Ç–æ–≤... (–Ω–∞–ø—Ä. 'bad guy')" autocomplete="off" />
    <button onclick="search()">üîç</button>
  </div>

  <div id="content">
    <p class="no-results">–ù–∞—á–Ω–∏ –ø–æ–∏—Å–∫ ‚Äî –º–∏–ª–ª–∏–æ–Ω—ã —Ç—Ä–µ–∫–æ–≤ –∂–¥—É—Ç! üöÄ</p>
  </div>
</div>

<button class="playlist-btn" onclick="togglePlaylist()" id="playlistBtn">üìã</button>

<div class="player" id="player">
  <div class="now-playing">
    <img id="cover" src="" alt="">
    <div style="flex:1;">
      <h3 id="title" style="margin:0 0 4px; font-size:16px;">‚Äî</h3>
      <p id="artist" style="margin:0; font-size:14px; color:var(--text-secondary);">‚Äî</p>
      <p id="views" class="views">‚Äî</p>
    </div>
    <button onclick="toggleLike()" style="background:none; border:none; color:var(--text); font-size:24px; cursor:pointer;">‚ù§Ô∏è</button>
  </div>
  <div class="controls">
    <button onclick="prevTrack()">‚èÆÔ∏è</button>
    <button id="playBtn" onclick="togglePlay()">‚ñ∂Ô∏è</button>
    <button onclick="nextTrack()">‚è≠Ô∏è</button>
  </div>
  <div class="progress"><div class="progress-bar" id="progress"></div></div>
  <div id="video-container" class="video-player"></div>
</div>

<script>
const API_KEY = '–í–°–¢–ê–í–¨_–°–í–û–ô_API_–ö–õ–Æ–ß_–ó–î–ï–°–¨'; // –ó–∞–º–µ–Ω–∏ –Ω–∞ —Å–≤–æ–π –∫–ª—é—á!

let tracks = [];
let currentIndex = 0;
let isPlaying = false;
let ytPlayer = null;

async function search() {
  const query = document.getElementById('query').value.trim();
  if (!query) return;

  document.getElementById('content').innerHTML = '<div class="loading"><div class="spinner"></div><p>–ò—â–µ–º —Ö–∏—Ç—ã...</p></div>';

  try {
    const response = await fetch(`https://www.googleapis.com/youtube/v3/search?part=snippet&q=${encodeURIComponent(query + ' official audio')}&type=video&maxResults=20&videoCategoryId=10&key=${API_KEY}`);
    const data = await response.json();

    if (data.items && data.items.length > 0) {
      tracks = data.items.map(item => ({
        id: item.id.videoId,
        title: item.snippet.title,
        artist: item.snippet.channelTitle,
        cover: item.snippet.thumbnails.medium.url,
        videoUrl: `https://www.youtube.com/watch?v=${item.id.videoId}`,
        duration: '3:45', // –î–ª—è —Ä–µ–∞–ª—å–Ω–æ–π –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –¥–æ–±–∞–≤—å part=contentDetails –≤ –∑–∞–ø—Ä–æ—Å
        views: '1M+' // –ó–∞–≥–ª—É—à–∫–∞; –∏—Å–ø–æ–ª—å–∑—É–π statistics API –¥–ª—è —Ä–µ–∞–ª–∞
      }));
      displayTracks(tracks);
    } else {
      // Fallback –±–µ–∑ "official audio"
      const fallbackResponse = await fetch(`https://www.googleapis.com/youtube/v3/search?part=snippet&q=${encodeURIComponent(query)}&type=video&maxResults=20&key=${API_KEY}`);
      const fallbackData = await fallbackResponse.json();
      tracks = fallbackData.items ? fallbackData.items.map(item => ({
        id: item.id.videoId,
        title: item.snippet.title,
        artist: item.snippet.channelTitle,
        cover: item.snippet.thumbnails.medium.url,
        videoUrl: `https://www.youtube.com/watch?v=${item.id.videoId}`,
        duration: '3:45',
        views: '1M+'
      })) : [];
      displayTracks(tracks);
    }

    if (tracks.length === 0) {
      document.getElementById('content').innerHTML = '<p class="no-results">–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ. –ü–æ–ø—Ä–æ–±—É–π –¥—Ä—É–≥–æ–π –∑–∞–ø—Ä–æ—Å! üòî</p>';
    }
  } catch(e) {
    document.getElementById('content').innerHTML = '<p class="no-results">–û—à–∏–±–∫–∞ API. –ü—Ä–æ–≤–µ—Ä—å –∫–ª—é—á –∏–ª–∏ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç! üîÑ</p>';
    console.error(e);
  }
}

function displayTracks(tracks) {
  document.getElementById('content').innerHTML = '<div class="results">' + tracks.map((t,i) => `
    <div class="track" onclick="playTrack(${i})">
      <img src="${t.cover}" onerror="this.src='https://i.imgur.com/3dRxX4V.jpg'">
      <div class="track-info">
        <h3>${t.title.length > 40 ? t.title.substring(0,37)+'...' : t.title}</h3>
        <p>${t.artist} <span class="service">YouTube</span></p>
        <p class="views">${t.views} –ø—Ä–æ—Å–º–æ—Ç—Ä–æ–≤</p>
      </div>
      <span class="duration">${t.duration}</span>
    </div>
  `).join('') + '</div>';
}

function playTrack(i) {
  currentIndex = i;
  const t = tracks[i];
  document.getElementById('title').textContent = t.title;
  document.getElementById('artist').textContent = t.artist;
  document.getElementById('cover').src = t.cover;
  document.getElementById('views').textContent = `${t.views} –ø—Ä–æ—Å–º–æ—Ç—Ä–æ–≤`;

  const videoId = t.id;
  document.getElementById('video-container').innerHTML = `
    <iframe 
      id="ytPlayer"
      src="https://www.youtube.com/embed/${videoId}?enablejsapi=1&autoplay=1&rel=0&modestbranding=1&playsinline=1&controls=1" 
      frameborder="0" 
      allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
      allowfullscreen 
      class="video-player"
    ></iframe>
  `;
  
  document.getElementById('player').style.display = 'block';
  isPlaying = true;
  document.getElementById('playBtn').textContent = '‚è∏Ô∏è';
  Telegram.WebApp.HapticFeedback.impactOccurred('light');
  
  // –ü—Ä–æ–≥—Ä–µ—Å—Å —á–µ—Ä–µ–∑ YouTube IFrame API
  window.onYouTubeIframeAPIReady = function() {
    ytPlayer = new YT.Player('ytPlayer', {
      events: {
        'onStateChange': onPlayerStateChange
      }
    });
  };
}

function onPlayerStateChange(event) {
  if (event.data === YT.PlayerState.PLAYING) {
    // –°–∏–º—É–ª—è—Ü–∏—è –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ (—Ä–µ–∞–ª—å–Ω—ã–π —á–µ—Ä–µ–∑ getCurrentTime)
    const interval = setInterval(() => {
      if (ytPlayer && ytPlayer.getDuration()) {
        const progress = (ytPlayer.getCurrentTime() / ytPlayer.getDuration()) * 100;
        document.getElementById('progress').style.width = progress + '%';
      }
    }, 1000);
  }
}

function togglePlay() {
  if (ytPlayer) {
    if (isPlaying) {
      ytPlayer.pauseVideo();
      document.getElementById('playBtn').textContent = '‚ñ∂Ô∏è';
    } else {
      ytPlayer.playVideo();
      document.getElementById('playBtn').textContent = '‚è∏Ô∏è';
    }
    isPlaying = !isPlaying;
  }
  Telegram.WebApp.HapticFeedback.selectionChanged();
}

function prevTrack() { if (currentIndex > 0) playTrack(currentIndex - 1); }
function nextTrack() { if (currentIndex < tracks.length - 1) playTrack(currentIndex + 1); }
function toggleLike() { Telegram.WebApp.HapticFeedback.notificationOccurred(); alert('–î–æ–±–∞–≤–ª–µ–Ω–æ –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ!'); }
function togglePlaylist() { alert('–ü–ª–µ–π–ª–∏—Å—Ç: ' + tracks.length + ' —Ç—Ä–µ–∫–æ–≤'); }

// –ê–≤—Ç–æ–∑–∞–ø—É—Å–∫ YouTube IFrame API
const tag = document.createElement('script');
tag.src = 'https://www.youtube.com/iframe_api';
const firstScriptTag = document.getElementsByTagName('script')[0];
firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

// Debounce –ø–æ–∏—Å–∫
let timeout;
document.getElementById('query').addEventListener('input', () => {
  clearTimeout(timeout);
  timeout = setTimeout(search, 500);
});
document.getElementById('query').addEventListener('keypress', e => { if(e.key==='Enter') search(); });

// TG init
Telegram.WebApp.ready();
Telegram.WebApp.expand();
document.body.style.marginBottom = '280px';
</script>

</body>
</html>
